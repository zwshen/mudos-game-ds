<HTML>
<HEAD>
<TITLE>BBS水木清華站︰精華區</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
<A Name="top"></a>
發信人:&nbsp;xstar&nbsp;(星際戰艦),&nbsp;信區:&nbsp;Mud_Builder&nbsp;<BR>
標&nbsp;&nbsp;題:&nbsp;MudOS&nbsp;v22升級指南&nbsp;<BR>
發信站:&nbsp;BBS&nbsp;水木清華站&nbsp;(Sun&nbsp;Mar&nbsp;&nbsp;1&nbsp;21:00:48&nbsp;1998)&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;如果你原來用的是MudOS&nbsp;v21.xx,&nbsp;則升級至v22需要進行以下改動：&nbsp;<BR>
1、刪除所有文件中在子類或外部使用的函數前面的private關鍵字。&nbsp;<BR>
&nbsp;&nbsp;&nbsp;或者簡單地刪除所有函數前面的private就行了。&nbsp;<BR>
比如：/feature/attack.c中的：&nbsp;<BR>
private&nbsp;int&nbsp;attack()&nbsp;<BR>
....&nbsp;<BR>
改為&nbsp;int&nbsp;attack()&nbsp;<BR>
&nbsp;<BR>
類似的情況還有：&nbsp;<BR>
&nbsp;&nbsp;/feature/action.c,&nbsp;treemap.c&nbsp;等。&nbsp;<BR>
&nbsp;<BR>
2、注意函數聲明的類型要與函數實際類型相同&nbsp;<BR>
比如：&nbsp;<BR>
void&nbsp;myfunction();&nbsp;<BR>
....&nbsp;<BR>
&nbsp;&nbsp;&nbsp;<BR>
int&nbsp;myfunction()&nbsp;<BR>
{&nbsp;<BR>
...&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
在v21裡可能沒問題，v22裡就不能正確執行。&nbsp;<BR>
&nbsp;<BR>
3、檢查所有用到函數指針的地方。&nbsp;<BR>
&nbsp;<BR>
v22不再支持形如(:&nbsp;ob,&nbsp;string&nbsp;:)這樣的函數指針類型，&nbsp;<BR>
&nbsp;<BR>
而需要改成：(:&nbsp;call_other,&nbsp;ob,&nbsp;string&nbsp;:)&nbsp;<BR>
比如在文件:&nbsp;/cmds/std/suicide.c&nbsp;中第44行&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;start_busy(&nbsp;(:&nbsp;__FILE__,&nbsp;&quot;slow_suicide&quot;,&nbsp;me&nbsp;:));&nbsp;<BR>
必須改成：&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;start_busy(&nbsp;(:&nbsp;call_other,&nbsp;__FILE__,&nbsp;&quot;slow_suicide&quot;,&nbsp;me&nbsp;:));&nbsp;<BR>
才能正確使用。&nbsp;<BR>
&nbsp;<BR>
類似的文件還有：&nbsp;<BR>
&nbsp;&nbsp;&nbsp;es2:&nbsp;/std/weapon/sword.c&nbsp;blade.c&nbsp;axe.c&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;xkx:&nbsp;/inherit/weapon/sword.c&nbsp;blade.c&nbsp;axe.c&nbsp;...&nbsp;<BR>
等等。&nbsp;<BR>
&nbsp;<BR>
4、修改origin.h&nbsp;<BR>
由於v22修改了origin函數的返回類型(從int改為string),&nbsp;<BR>
所以要修改origin.h:&nbsp;<BR>
&nbsp;<BR>
#define&nbsp;ORIGIN_BACKEND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1&nbsp;&nbsp;<BR>
#define&nbsp;ORIGIN_DRIVER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1&nbsp;<BR>
#define&nbsp;ORIGIN_LOCAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2&nbsp;<BR>
#define&nbsp;ORIGIN_CALL_OTHER&nbsp;&nbsp;&nbsp;&nbsp;0x4&nbsp;<BR>
#define&nbsp;ORIGIN_SIMUL_EFUN&nbsp;&nbsp;&nbsp;&nbsp;0x8&nbsp;<BR>
#define&nbsp;ORIGIN_CALL_OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10&nbsp;<BR>
#define&nbsp;ORIGIN_EFUN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x20&nbsp;<BR>
&nbsp;<BR>
改為：&nbsp;<BR>
&nbsp;<BR>
#define&nbsp;ORIGIN_DRIVER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;driver&quot;&nbsp;<BR>
#define&nbsp;ORIGIN_LOCAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;local&quot;&nbsp;<BR>
#define&nbsp;ORIGIN_CALL_OTHER&nbsp;&nbsp;&nbsp;&nbsp;&quot;call_other&quot;&nbsp;<BR>
#define&nbsp;ORIGIN_SIMUL_EFUN&nbsp;&nbsp;&nbsp;&nbsp;&quot;simul&quot;&nbsp;<BR>
#define&nbsp;ORIGIN_CALL_OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;call_out&quot;&nbsp;<BR>
#define&nbsp;ORIGIN_EFUN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;efun&quot;&nbsp;<BR>
&nbsp;<BR>
--&nbsp;<BR>
※&nbsp;來源:•BBS&nbsp;水木清華站&nbsp;bbs.net.tsinghua.edu.cn•[FROM:&nbsp;stu20.pubnic.bu]&nbsp;<BR>
<A HREF="00000004.htm">上一篇</A>
<A HREF='javascript:history.go(-1)'>返回上一頁</A>
<A HREF="index.htm">回到目錄</A>
<A HREF="#top">回到頁首</A>
<A HREF="00000006.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
</BODY></HTML>