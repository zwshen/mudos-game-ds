<HTML>
<HEAD>
<TITLE>BBS水木清華站︰精華區</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
<A Name="top"></a>
發信人:&nbsp;yeung&nbsp;(流星雨),&nbsp;信區:&nbsp;Mud_Builder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
標&nbsp;&nbsp;題:&nbsp;MUDOS中的函數指針&nbsp;-&nbsp;I&nbsp;<BR>
發信站:&nbsp;BBS&nbsp;水木清華站&nbsp;(Wed&nbsp;Dec&nbsp;22&nbsp;23:42:46&nbsp;1999)&nbsp;<BR>
&nbsp;<BR>
MUDOS中的函數指針&nbsp;<BR>
&nbsp;<BR>
(參考mudos&nbsp;v22pre11文檔寫作&nbsp;版權不要,這兩行要)&nbsp;<BR>
(by&nbsp;YEUNG&nbsp;1999/12/22)&nbsp;<BR>
&nbsp;<BR>
MUDOS支持一種變量類型叫做&quot;函數指針&quot;,可以用來指向各種函數.&nbsp;<BR>
可能你已經很熟悉把函數作為參數傳遞給特定的EFUN了,&nbsp;<BR>
比如大家常用的filter_array.這個函數從一個數組中挑選成員,只&nbsp;<BR>
有那些讓過濾函數返回true(!0)的成員才被返回.傳統上,大家通過&nbsp;<BR>
傳遞object和函數名稱來完成這項工作.現在大家可以直接使用函&nbsp;<BR>
數指針來完成這項工作.&nbsp;<BR>
&nbsp;<BR>
函數指針使用&nbsp;(:&nbsp;:)&nbsp;成對操作符來產生.&nbsp;<BR>
比如&nbsp;<BR>
&nbsp;<BR>
function&nbsp;f;&nbsp;<BR>
&nbsp;<BR>
int&nbsp;my_function(string&nbsp;arg)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(arg+&quot;&nbsp;is&nbsp;a&nbsp;pig\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
f&nbsp;=&nbsp;(:&nbsp;my_function&nbsp;:);&nbsp;<BR>
&nbsp;<BR>
然後f可以就可以作為普通的參數傳遞給其他函數或者EFUN.&nbsp;<BR>
比如&nbsp;map_array(&nbsp;({&quot;akuma&quot;,&quot;nerd&quot;}),f&nbsp;);&nbsp;<BR>
也可以在以後的某個時候執行這個函數,比如&nbsp;<BR>
x&nbsp;=&nbsp;evalute(f,&quot;olives&quot;);&nbsp;<BR>
//這行執行的時候,f指向的內存地址存放的函數被調用,同時把&quot;olives&quot;&nbsp;<BR>
作為參數傳遞過去.&nbsp;<BR>
結果當然是輸出:&nbsp;olives&nbsp;is&nbsp;a&nbsp;pig,和執行my_function(&quot;olives&quot;)的效果&nbsp;<BR>
等同.&nbsp;<BR>
&nbsp;<BR>
值得注意的是,evaluate這個efun如果其參數不是函數指針,就直接返回&nbsp;<BR>
這個參數的值,比如evaluate(f,&quot;olives&quot;)是執行my_function,&nbsp;<BR>
evaluate(&quot;nerd&nbsp;is&nbsp;a&nbsp;pig&quot;)就直接返回&quot;nerd&nbsp;is&nbsp;a&nbsp;pig&quot;&nbsp;<BR>
&nbsp;<BR>
evalute的這個特性是可以利用的比如我們的char有這麼一對函數query_short()&nbsp;<BR>
set_short(),一般的mudlib都是設成一個string完事,玩的時候看是不會變的.&nbsp;<BR>
現在我們可以這麼寫:&nbsp;<BR>
//&nbsp;&nbsp;/feature/name.c&nbsp;by&nbsp;yeung&nbsp;<BR>
mixed&nbsp;myshort;&nbsp;<BR>
mixed&nbsp;query_short()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;evaluate(short);&nbsp;<BR>
}&nbsp;<BR>
int&nbsp;set_short(mixed&nbsp;short)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myshort&nbsp;=&nbsp;short;&nbsp;<BR>
}&nbsp;<BR>
這個文件會被char.c繼承的&nbsp;<BR>
然後我們寫一個NPC的時候,這麼寫好了&nbsp;<BR>
//&nbsp;demo&nbsp;npc&nbsp;<BR>
&nbsp;<BR>
inherit&nbsp;NPC;&nbsp;<BR>
string&nbsp;look_me()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this_player()-&gt;name()+&quot;家的小豬&nbsp;-&nbsp;AKUMA&quot;;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
void&nbsp;create()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set(&quot;id&quot;,&quot;pig&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_short(&nbsp;(:look_me:)&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
}&nbsp;<BR>
這樣,我經過的時候,看到的就是&quot;流星雨家的小豬&nbsp;-&nbsp;AKUMA(pig)&quot;,別人&nbsp;<BR>
看的不一樣喔.&nbsp;<BR>
&nbsp;<BR>
休息一下&nbsp;-------&nbsp;待會再講比較繞的第二課.&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
--&nbsp;<BR>
夢後樓台高鎖，酒醒簾幕低垂&nbsp;<BR>
去年春恨卻來時，落花人獨立，微雨燕雙飛&nbsp;<BR>
&nbsp;<BR>
記得小蘋初見，兩重心字羅衣&nbsp;<BR>
琵琶弦上說相思，當時明月在，曾照彩雲歸&nbsp;<BR>
&nbsp;<BR>
※&nbsp;來源:•BBS&nbsp;水木清華站&nbsp;smth.org•[FROM:&nbsp;162.105.138.50]&nbsp;<BR>
<A HREF='javascript:history.go(-1)'>返回上一頁</A>
<A HREF="index.htm">回到目錄</A>
<A HREF="#top">回到頁首</A>
<A HREF="00000001.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
</BODY></HTML>