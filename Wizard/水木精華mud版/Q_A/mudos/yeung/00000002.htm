<HTML>
<HEAD>
<TITLE>BBS水木清華站︰精華區</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
<A Name="top"></a>
發信人:&nbsp;yeung&nbsp;(流星雨),&nbsp;信區:&nbsp;Mud_Builder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
標&nbsp;&nbsp;題:&nbsp;MUDOS中的函數指針&nbsp;-&nbsp;III&nbsp;<BR>
發信站:&nbsp;BBS&nbsp;水木清華站&nbsp;(Thu&nbsp;Dec&nbsp;23&nbsp;00:35:29&nbsp;1999)&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
總算要講完了,都後半夜了,faint,明天上班&nbsp;<BR>
又只好看著MUD裡面的MM發呆睡覺了.&nbsp;<BR>
&nbsp;<BR>
III&nbsp;-&nbsp;函數指針使用中,參數和函數本身什麼時候執行?&nbsp;<BR>
&nbsp;<BR>
規則是:&nbsp;EFUN,本地函數,SIMUL_EFUN裡面的在創建時候就指定的以後不會動的參數,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在生成函數指針的同時執行.而表達式,函數指針這些參數,在eavaluate的&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;時候才執行.&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;太繞了,舉個例子:&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;f&nbsp;=&nbsp;(:&nbsp;destruct,this_player()&nbsp;:);&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//比如這裡的this_player()返回akuma的user_ob&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluate(f);&nbsp;//執行到這裡的時候,this_player()是nerd的user_ob了&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最後完蛋的是akuma,就是說:&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;*******在evaluate的時候destruct的是在f創建的時候的this_player()********&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;再看一個:&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;f&nbsp;=&nbsp;(:&nbsp;destruct(this_player())&nbsp;:);&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//比如這裡的this_player()返回akuma的user_ob&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluate(f);&nbsp;//執行到這裡的時候,比如this_player()是nerd的user_ob&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最後完蛋的是nerd,就是說:&nbsp;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;*******在evaluate的時候destruct的是在f執行的時候的this_player()********&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;<BR>
基於上述理由,&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;*****在表達式指針裡面使用本地變量是非法的*********,&nbsp;<BR>
&nbsp;<BR>
因為等到執行的時候,這個本地變量早就不知道哪裡去了,這就是為什麼在call_out&nbsp;<BR>
執行的函數里面不許使用this_player()的道理,&nbsp;<BR>
而必須在開始就把this_player()抓出來作為object參數傳下去.&nbsp;<BR>
&nbsp;<BR>
有沒有變通的辦法呢,當然有的.&nbsp;<BR>
還是上面的例子:&nbsp;(:&nbsp;destruct(&nbsp;$(this_player)&nbsp;)&nbsp;:)&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;這個就和第一個效果相同了&nbsp;<BR>
&nbsp;&nbsp;&nbsp;$代表執行這個表達式/函數,然後存住它的值給以後執行的時候用.現在MUDOS有個&nbsp;<BR>
編譯選項是#define&nbsp;THIS_PLAYER_IN_CALL_OUT&nbsp;就是MUDOS幫你自動hold住call_out&nbsp;<BR>
時的this_player()的數值.&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
這麼做有什麼好處呢?對於覺得自己的服務器確實還是慢的變態天神們,這是個好消&nbsp;<BR>
息,因為更有效率.可以這樣來逼自己的小巫師們改進程序.&nbsp;<BR>
比如:&nbsp;<BR>
&nbsp;<BR>
map_array(listeners,&nbsp;(:&nbsp;tell_object($1,&nbsp;$(this_player()-&gt;query_name())&nbsp;+&nbsp;<BR>
&nbsp;&quot;真是豬啊.\n&quot;)&nbsp;:)&nbsp;);&nbsp;&nbsp;<BR>
只執行一個call_other,而不需要每個message都要執行一下.&nbsp;<BR>
&nbsp;<BR>
map_array(listeners,&nbsp;(:&nbsp;tell_object($1,&nbsp;$(this_player)-&gt;query_name()&nbsp;+&nbsp;<BR>
&quot;真是豬啊.\n&quot;))&nbsp;:)&nbsp;);&nbsp;&nbsp;&nbsp;&nbsp;<BR>
這個效率就低多了.&nbsp;<BR>
&nbsp;<BR>
不加$就爛的一塌糊塗了,而且會出錯.&nbsp;<BR>
&nbsp;<BR>
也可以這麼寫的:&nbsp;<BR>
map_array(listeners,&nbsp;(:&nbsp;tell_object,&nbsp;this_player()-&gt;query_name()&nbsp;+&nbsp;&quot;真是&nbsp;<BR>
豬啊.\n&quot;&nbsp;:)&nbsp;);&nbsp;&nbsp;<BR>
結果和效率和上面兩個比如何,自己想想吧.&nbsp;:)&nbsp;<BR>
&nbsp;<BR>
-----------------完------------------&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;謝謝大家&nbsp;<BR>
&nbsp;<BR>
--&nbsp;<BR>
夢後樓台高鎖，酒醒簾幕低垂&nbsp;<BR>
去年春恨卻來時，落花人獨立，微雨燕雙飛&nbsp;<BR>
&nbsp;<BR>
記得小蘋初見，兩重心字羅衣&nbsp;<BR>
琵琶弦上說相思，當時明月在，曾照彩雲歸&nbsp;<BR>
&nbsp;<BR>
※&nbsp;修改:•yeung&nbsp;於&nbsp;Dec&nbsp;23&nbsp;00:42:34&nbsp;修改本文•[FROM:&nbsp;&nbsp;162.105.138.50]&nbsp;<BR>
※&nbsp;來源:•BBS&nbsp;水木清華站&nbsp;smth.org•[FROM:&nbsp;162.105.138.50]&nbsp;<BR>
<A HREF="00000001.htm">上一篇</A>
<A HREF='javascript:history.go(-1)'>返回上一頁</A>
<A HREF="index.htm">回到目錄</A>
<A HREF="#top">回到頁首</A>
<A HREF="00000003.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
</BODY></HTML>