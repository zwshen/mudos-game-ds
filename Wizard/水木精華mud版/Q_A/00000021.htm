<HTML>
<HEAD>
<TITLE>BBS水木清華站︰精華區</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
<A Name="top"></a>
發信人:&nbsp;anglee&nbsp;(sonny),&nbsp;信區:&nbsp;Mud_Builder&nbsp;<BR>
&nbsp;<BR>
【&nbsp;在&nbsp;nerd&nbsp;(快樂的感覺永遠一樣)&nbsp;的大作中提到:&nbsp;】&nbsp;<BR>
︰<I>&nbsp;這些東西並不重要，還是那個dbase.c很重要的。&nbsp;</I><BR>
&nbsp;<BR>
&nbsp;&nbsp;hi,&nbsp;&nbsp;nerd,&nbsp;I&nbsp;am&nbsp;小高&nbsp;(gao)&nbsp;thanks&nbsp;for&nbsp;you&nbsp;mudos&nbsp;for&nbsp;nt&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;問題已經解決了,將mudos&nbsp;for&nbsp;linux&nbsp;移植到NT下需修改&nbsp;<BR>
&nbsp;&nbsp;許多東西，基本有以下三個方面&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;1。去掉#pragma&nbsp;<BR>
&nbsp;&nbsp;2。&nbsp;函數前必須有返回類型&nbsp;<BR>
&nbsp;&nbsp;3。&nbsp;類型不匹配必須進行強制類型轉換&nbsp;<BR>
&nbsp;&nbsp;4。&nbsp;修改某些成員函數的private為public&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;現在總算在NT上跑起來了，網間的chat也通了&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;但還發現一個問題&nbsp;<BR>
&nbsp;&nbsp;我把自己的功夫改到add/def&nbsp;為&nbsp;12xxxx/12xxxx，exp=5000000,&nbsp;<BR>
&nbsp;&nbsp;竟然殺MASTER不死，同swordsman&nbsp;你打不到我，我也打不到你，&nbsp;<BR>
&nbsp;&nbsp;兩人玩起捉迷藏，在LINUX下，兩掌就把他打爬下了。以前我用&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;mudos&nbsp;for&nbsp;95&nbsp;和它自帶的mudlib也有這個問題，我看了combatd.c&nbsp;<BR>
&nbsp;&nbsp;也沒發現什麼異常。&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;who&nbsp;can&nbsp;help&nbsp;me??&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
發信人:&nbsp;Davis&nbsp;(太酷了！),&nbsp;信區:&nbsp;Mud_Builder&nbsp;<BR>
&nbsp;<BR>
【&nbsp;在&nbsp;anglee&nbsp;(sonny)&nbsp;的大作中提到:&nbsp;】&nbsp;<BR>
︰<I>&nbsp;&nbsp;&nbsp;hi,&nbsp;&nbsp;nerd,&nbsp;I&nbsp;am&nbsp;小高&nbsp;(gao)&nbsp;thanks&nbsp;for&nbsp;you&nbsp;mudos&nbsp;for&nbsp;nt&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;問題已經解決了,將mudos&nbsp;for&nbsp;linux&nbsp;移植到NT下需修改&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;許多東西，基本有以下三個方面&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;1。去掉#pragma&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;2。&nbsp;函數前必須有返回類型&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;3。&nbsp;類型不匹配必須進行強制類型轉換&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;4。&nbsp;修改某些成員函數的private為public&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;現在總算在NT上跑起來了，網間的chat也通了&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;但還發現一個問題&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;我把自己的功夫改到add/def&nbsp;為&nbsp;12xxxx/12xxxx，exp=5000000,&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;竟然殺MASTER不死，同swordsman&nbsp;你打不到我，我也打不到你，&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;兩人玩起捉迷藏，在LINUX下，兩掌就把他打爬下了。以前我用&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mudos&nbsp;for&nbsp;95&nbsp;和它自帶的mudlib也有這個問題，我看了combatd.c&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;也沒發現什麼異常。&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;who&nbsp;can&nbsp;help&nbsp;me??&nbsp;</I><BR>
這個問題老早在mud板就討論過，最直接的原因是95與NT下，你修改出的&nbsp;<BR>
數值溢出了，因此無論多高也是無用的，按照整數的計算，95下應該65535以上&nbsp;<BR>
就會溢出，而NT稍強有限（32位）（也有可能是一樣的），在LINUX下由於可能&nbsp;<BR>
是64位的系統，因此12萬不會溢出。&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
發信人:&nbsp;peacock&nbsp;(孔雀明王),&nbsp;信區:&nbsp;Mud_Builder&nbsp;<BR>
&nbsp;<BR>
【&nbsp;在&nbsp;Ranma&nbsp;(亂馬)&nbsp;的大作中提到:&nbsp;】&nbsp;<BR>
︰<I>&nbsp;還是那個random得問題，原來以為在NT下Randdom()得bug會改過來&nbsp;</I><BR>
︰<I>&nbsp;布知道mudops調的random()是vc的庫函數還是windows的庫函數，&nbsp;</I><BR>
︰<I>&nbsp;在random(x)xx很大的情況下布完全是隨機的啦,前面有文章說道這個問題了&nbsp;</I><BR>
原來的文章是我寫的，剛才看來一下前面的文章，好像找不出來了，也沒被收&nbsp;<BR>
到精華區，只好再寫一遍了。&nbsp;<BR>
&nbsp;<BR>
MS的random(x)&nbsp;函數有問題，在x&nbsp;&gt;&gt;&nbsp;10000的時候分布不均勻。大體上&nbsp;<BR>
random(100000)的返回值集中在10000到25000之間，偶爾能看見8000幾，&nbsp;<BR>
超過40000&nbsp;的時候幾乎沒有。而且x&nbsp;再上升，好像分布也不見提高。&nbsp;<BR>
&nbsp;<BR>
解決辦法是變一下隨機數的引用方法。&nbsp;<BR>
&nbsp;<BR>
判斷打中打不中，combatd.c&nbsp;裡用的是&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;random(&nbsp;ap&nbsp;+&nbsp;dp&nbsp;)&nbsp;&lt;&nbsp;dp&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//躲閃成功；&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;random(ap&nbsp;+&nbsp;pp&nbsp;)&nbsp;&lt;&nbsp;pp&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//招架成功&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//擊中&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
所以你攻防一高，就會出現誰也打不著誰的情況。&nbsp;<BR>
&nbsp;<BR>
只要把&nbsp;if&nbsp;(&nbsp;random(&nbsp;ap&nbsp;+&nbsp;dp)&nbsp;&gt;&nbsp;dp&nbsp;)&nbsp;<BR>
改成&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;random(100)&nbsp;&gt;&nbsp;dp&nbsp;*&nbsp;100&nbsp;/&nbsp;(&nbsp;ap&nbsp;+&nbsp;dp)&nbsp;)就成了。&nbsp;<BR>
誤差在1%範圍內，應該是可以接受的吧？&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
發信人:&nbsp;Ranma&nbsp;(亂馬~~~~~~~無聊中),&nbsp;信區:&nbsp;Mud_Builder&nbsp;<BR>
&nbsp;<BR>
我想在95環境下跑mudos，能不能重寫random()呢，&nbsp;<BR>
以前想到要重寫，但是不知道怎麼調用被繼承的efun,&nbsp;<BR>
看了關於add_action的討論我想，在95下random()可以&nbsp;<BR>
重寫為這個樣子：&nbsp;<BR>
&nbsp;<BR>
float&nbsp;random(float&nbsp;max)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;if&nbsp;(max&gt;10000)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;efun::random(max/100)&nbsp;*&nbsp;100;&nbsp;<BR>
&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;efun::random(max);&nbsp;<BR>
}&nbsp;<BR>
本來我想這樣寫的，利用參數不同來選擇調用的是原型還是用戶重載的&nbsp;<BR>
因為一般用戶都是int的參數，int的返回值，所以可以寫成如下形式&nbsp;<BR>
int&nbsp;random(int&nbsp;max)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;if&nbsp;(max&gt;10000)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)&nbsp;random((float)&nbsp;max/100)&nbsp;*&nbsp;100;&nbsp;<BR>
&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)&nbsp;random((float)&nbsp;max);&nbsp;<BR>
}&nbsp;<BR>
【&nbsp;在&nbsp;peacock&nbsp;(孔雀明王)&nbsp;的大作中提到:&nbsp;】&nbsp;<BR>
︰<I>&nbsp;原來的文章是我寫的，剛才看來一下前面的文章，好像找不出來了，也沒被收&nbsp;</I><BR>
︰<I>&nbsp;到精華區，只好再寫一遍了。&nbsp;</I><BR>
︰<I>&nbsp;MS的random(x)&nbsp;函數有問題，在x&nbsp;&gt;&gt;&nbsp;10000的時候分布不均勻。大體上&nbsp;</I><BR>
︰<I>&nbsp;random(100000)的返回值集中在10000到25000之間，偶爾能看見8000幾，&nbsp;</I><BR>
︰<I>&nbsp;超過40000&nbsp;的時候幾乎沒有。而且x&nbsp;再上升，好像分布也不見提高。&nbsp;</I><BR>
︰<I>&nbsp;解決辦法是變一下隨機數的引用方法。&nbsp;</I><BR>
︰<I>&nbsp;判斷打中打不中，combatd.c&nbsp;裡用的是&nbsp;&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;random(&nbsp;ap&nbsp;+&nbsp;dp&nbsp;)&nbsp;&lt;&nbsp;dp&nbsp;)&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//躲閃成功；&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;random(ap&nbsp;+&nbsp;pp&nbsp;)&nbsp;&lt;&nbsp;pp&nbsp;)&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//招架成功&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//擊中&nbsp;</I><BR>
︰<I>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</I><BR>
︰<I>&nbsp;所以你攻防一高，就會出現誰也打不著誰的情況。&nbsp;</I><BR>
︰<I>&nbsp;只要把&nbsp;if&nbsp;(&nbsp;random(&nbsp;ap&nbsp;+&nbsp;dp)&nbsp;&gt;&nbsp;dp&nbsp;)&nbsp;</I><BR>
︰<I>&nbsp;改成&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;random(100)&nbsp;&gt;&nbsp;dp&nbsp;*&nbsp;100&nbsp;/&nbsp;(&nbsp;ap&nbsp;+&nbsp;dp)&nbsp;)就成了。&nbsp;</I><BR>
︰<I>&nbsp;誤差在1%範圍內，應該是可以接受的吧？&nbsp;</I><BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
<A HREF="00000020.htm">上一篇</A>
<A HREF='javascript:history.go(-1)'>返回上一頁</A>
<A HREF="index.htm">回到目錄</A>
<A HREF="#top">回到頁首</A>
<A HREF="00000022.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清華站︰精華區</H1></CENTER>
</BODY></HTML>