<HTML>
<HEAD>
<TITLE>BBS水木清华站∶精华区</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清华站∶精华区</H1></CENTER>
<A Name="top"></a>
发信人:&nbsp;say&nbsp;(秋枫),&nbsp;信区:&nbsp;Mud_Builder&nbsp;<BR>
标&nbsp;&nbsp;题:&nbsp;一个方便巫师的工具objmaker&nbsp;<BR>
发信站:&nbsp;BBS&nbsp;水木清华站&nbsp;(Sat&nbsp;Dec&nbsp;20&nbsp;10:21:50&nbsp;1997)&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
//&nbsp;objmaker.c&nbsp;created&nbsp;by&nbsp;Hunter(秋风)&nbsp;<BR>
//&nbsp;for&nbsp;ESLib&nbsp;<BR>
&nbsp;<BR>
#define&nbsp;RMK_VERSION&nbsp;&quot;(v1.0)&quot;&nbsp;<BR>
&nbsp;<BR>
inherit&nbsp;ITEM;&nbsp;<BR>
inherit&nbsp;F_AUTOLOAD;&nbsp;<BR>
&nbsp;<BR>
string&nbsp;*special_props&nbsp;=&nbsp;({&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;,&nbsp;&quot;long&quot;&nbsp;});&nbsp;<BR>
&nbsp;<BR>
int&nbsp;save_room_file(string&nbsp;file,string&nbsp;str);&nbsp;<BR>
&nbsp;<BR>
void&nbsp;create()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_name(&quot;物件编辑器&quot;&nbsp;+&nbsp;RMK_VERSION,&nbsp;({&nbsp;&quot;objmaker&quot;,&nbsp;&quot;maker&quot;&nbsp;})&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_weight(100);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set(&quot;unit&quot;,&nbsp;&quot;个&quot;&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set(&quot;long&quot;,&nbsp;@LONG&nbsp;<BR>
这是一个用来「快速」制造房间的工具，帮助时间不多或有严重&nbsp;&nbsp;lag&nbsp;的巫师&nbsp;<BR>
利用线上输入制造简单的房间，不过如果你想提高自己区域房间的品质，最好&nbsp;<BR>
不要太依赖这个东西，你可以使用以下几个指令：&nbsp;<BR>
&nbsp;<BR>
mkobj&nbsp;&lt;物件档名&gt;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;造出一个「废物」放在身上，之後你可以&nbsp;rrset&nbsp;设定物件的&nbsp;&nbsp;&nbsp;&nbsp;叙述或&nbsp;<BR>
属性。&nbsp;<BR>
&nbsp;<BR>
rset1&nbsp;&lt;物件属性&gt;&nbsp;&lt;属性内容&gt;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;设定你身上的临时物件属性，如&nbsp;name(not&nbsp;short!)，long,id&nbsp;等&nbsp;set&nbsp;内&nbsp;<BR>
有引号的set&nbsp;。&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
saveobj&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;将你身上的临时物件存档为正式物件。&nbsp;<BR>
&nbsp;<BR>
rset2&nbsp;&lt;物件属性&gt;&nbsp;&lt;属性内容&gt;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设定那些&nbsp;set&nbsp;内没有引号的属性，如&nbsp;no_drop,no_get,value等。&nbsp;<BR>
LONG&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;query_autoload()&nbsp;{&nbsp;return&nbsp;1;&nbsp;}&nbsp;<BR>
&nbsp;<BR>
void&nbsp;init()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;wizardp(environment())&nbsp;)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seteuid(getuid(environment()));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_action(&quot;do_mkobj&quot;,&nbsp;&quot;mkobj&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_action(&quot;do_rset&quot;,&nbsp;&quot;rset1&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_action(&quot;do_saveobj&quot;,&nbsp;&quot;saveobj&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_action(&quot;do_rrset&quot;,&quot;rset2&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;do_mkobj(string&nbsp;arg)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;file,code;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;file1;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;sscanf(arg,&nbsp;&quot;%s&quot;,&nbsp;file)!=1&nbsp;)&nbsp;<BR>
return&nbsp;notify_fail(&quot;指令格式：mkobj&nbsp;&lt;物件档名&gt;\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seteuid(geteuid(this_player()));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;=&nbsp;resolve_path(this_player()-&gt;query(&quot;cwd&quot;),&nbsp;file)&nbsp;+&nbsp;&quot;.c&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;file_size(file)!=-1&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;notify_fail(&quot;档案&nbsp;&quot;&nbsp;+&nbsp;file&nbsp;+&nbsp;&quot;&nbsp;已经存在了。\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!write_file(file&nbsp;,@OBJ_CODE&nbsp;<BR>
//&nbsp;This&nbsp;is&nbsp;a&nbsp;obj&nbsp;made&nbsp;by&nbsp;objmaker.&nbsp;<BR>
&nbsp;<BR>
inherit&nbsp;ITEM;&nbsp;<BR>
&nbsp;<BR>
void&nbsp;create()&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_name(&quot;无用物&quot;,&nbsp;({&nbsp;&quot;obj&quot;&nbsp;})&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set(&quot;long&quot;,&nbsp;&quot;这是一个不值钱的废物。\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setup();&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
OBJ_CODE&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;)&nbsp;return&nbsp;notify_fail(&quot;你没有写入档案(&quot;&nbsp;+&nbsp;file&nbsp;+&quot;)的权利。\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1=new(file);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1-&gt;move(this_player());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_vision(&quot;只听到$N的物件编辑器「哔」的一声，你觉得身上多了一件东西。\n&quot;,&nbsp;this_player());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;do_rset(string&nbsp;arg)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;prop,&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;ob;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mixed&nbsp;data;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!arg&nbsp;||&nbsp;sscanf(arg,&nbsp;&quot;%s&nbsp;%s&quot;,&nbsp;prop,&nbsp;str)!=2&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;notify_fail(&quot;指令格式：rset1&nbsp;&lt;物件属性&gt;&nbsp;&lt;属性内容&gt;\n&quot;);&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;sscanf(str,&nbsp;&quot;%d&quot;,&nbsp;data)!=1&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob=present(&quot;obj&quot;,this_player());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob-&gt;set(prop,str);&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment(this_player())-&gt;set(prop,&nbsp;str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;Ok.\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;do_rrset(string&nbsp;arg)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;prop;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;ob;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mixed&nbsp;str;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!arg&nbsp;||&nbsp;sscanf(arg,&nbsp;&quot;%s&nbsp;%d&quot;,&nbsp;prop,&nbsp;str)!=2&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;notify_fail(&quot;指令格式：rset2&nbsp;&lt;物件属性&gt;&nbsp;&lt;属性内容&gt;\n&quot;);&nbsp;<BR>
&nbsp;<BR>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;sscanf(str,&nbsp;&quot;%d&quot;,&nbsp;data)!=1&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;str;*/&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob=present(&quot;obj&quot;,this_player());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob-&gt;set(prop,str);&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment(this_player())-&gt;set(prop,&nbsp;str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;Ok.\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;do_saveobj(string&nbsp;arg)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;env;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;str,&nbsp;*name1,&nbsp;file1,file;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapping&nbsp;prop;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i,age1;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env&nbsp;=&nbsp;present(&quot;obj&quot;,this_player());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1&nbsp;=&nbsp;file_name(env)&nbsp;+&nbsp;&quot;.c&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!arg&nbsp;||&nbsp;sscanf(arg,&nbsp;&quot;%d&quot;,age1)!=1&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;notify_fail(&quot;指令格式：saveobj&nbsp;&lt;重量&gt;\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;=&nbsp;&quot;//&nbsp;Obj:&nbsp;&quot;+file1&nbsp;+&nbsp;&nbsp;@OBJ_CODE&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
inherit&nbsp;ITEM;&nbsp;<BR>
&nbsp;<BR>
void&nbsp;create()&nbsp;<BR>
{&nbsp;<BR>
OBJ_CODE&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;+=&nbsp;sprintf(&quot;\tset_name(\&quot;%s\&quot;,&nbsp;({\&quot;%s\&quot;}));\n&quot;,&nbsp;env-&gt;query(&quot;name&quot;),env-&gt;query(&quot;id&quot;));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;+=&nbsp;sprintf(&quot;\tset(\&quot;long\&quot;,&nbsp;@LONG\n%s\nLONG\n\t);\n&quot;,&nbsp;env-&gt;query(&quot;long&quot;)&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop&nbsp;=&nbsp;env-&gt;query_entire_dbase();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name1&nbsp;=&nbsp;keys(prop);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=0;&nbsp;i&lt;sizeof(name1);&nbsp;i++)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;member_array(name1[i],&nbsp;special_props)!=-1&nbsp;)&nbsp;continue;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;+=&nbsp;sprintf(&quot;\tset(\&quot;%s\&quot;,&nbsp;%O);\n&quot;,&nbsp;name1[i],&nbsp;prop[name1[i]]&nbsp;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;+=&nbsp;sprintf(&quot;\tset_weight(%O);\n&quot;,age1);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;+=&nbsp;&quot;\n\tsetup();\n}\n&quot;;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Replace&nbsp;current&nbsp;directory&nbsp;with&nbsp;__DIR__&nbsp;macro&nbsp;to&nbsp;make&nbsp;relocatable&nbsp;code.&nbsp;<BR>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;file_size(file)!=-1&nbsp;)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;档案&nbsp;&quot;&nbsp;+&nbsp;file&nbsp;+&nbsp;&quot;&nbsp;已存在，要删除旧档吗？[y/n]&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_to(&quot;save_room_file&quot;,file,str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}*/&nbsp;<BR>
&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;save_room_file(&quot;y&quot;,file,str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;请输入新档名:&nbsp;&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_to(&quot;save_room_file&quot;,str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;save_room_file(string&nbsp;file,string&nbsp;str)&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;ob;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;=&nbsp;resolve_path(this_player()-&gt;query(&quot;cwd&quot;),&nbsp;file)&nbsp;+&nbsp;&quot;.c&quot;;&nbsp;<BR>
&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;wizardp(environment())&nbsp;)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob=present(&quot;obj&quot;,this_player());&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seteuid(getuid(environment()));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seteuid(getuid(ob));&nbsp;<BR>
&nbsp;<BR>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;strlen(yn)&lt;1&nbsp;||&nbsp;yn[0]!='y'&nbsp;)&nbsp;return&nbsp;1;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm(file);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(str);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;存档&nbsp;&quot;&nbsp;+&nbsp;file&nbsp;+&nbsp;&quot;....&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;write_file(file,&nbsp;str)&nbsp;)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(&quot;Ok.\n&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;notify_fail(&quot;你没有写入这个档案(&quot;&nbsp;+&nbsp;file&nbsp;+&nbsp;&quot;)的权利。\n&quot;);&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
void&nbsp;owner_is_killed()&nbsp;{&nbsp;destruct(this_object());&nbsp;}&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
--&nbsp;<BR>
※&nbsp;来源:・BBS&nbsp;水木清华站&nbsp;bbs.net.tsinghua.edu.cn・[FROM:&nbsp;202.116.13.36]&nbsp;<BR>
<A HREF="00000017.htm">上一篇</A>
<A HREF='javascript:history.go(-1)'>返回上一页</A>
<A HREF="index.htm">回到目录</A>
<A HREF="#top">回到页首</A>
<A HREF="00000019.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清华站∶精华区</H1></CENTER>
</BODY></HTML>