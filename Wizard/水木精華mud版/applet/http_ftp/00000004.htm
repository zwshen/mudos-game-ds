<HTML>
<HEAD>
<TITLE>BBS水木清华站∶精华区</TITLE>
</HEAD>
<BODY>
<CENTER><H1>BBS水木清华站∶精华区</H1></CENTER>
<A Name="top"></a>
发信人:&nbsp;nightwatch&nbsp;(夜游神),&nbsp;信区:&nbsp;Mud_Builder&nbsp;<BR>
标&nbsp;&nbsp;题:&nbsp;在MUD中增加HTTP和FTP服务(5)&nbsp;<BR>
发信站:&nbsp;BBS&nbsp;水木清华站&nbsp;(Tue&nbsp;Jan&nbsp;26&nbsp;18:32:10&nbsp;1999)&nbsp;WWW-POST&nbsp;<BR>
&nbsp;<BR>
以下是我在MUD中编写的一些在MUDLIB中实现&nbsp;<BR>
HTTP服务和FTP服务的程序&nbsp;<BR>
&nbsp;<BR>
以下部分在校园网已经测试通过。有兴趣的话请帮&nbsp;<BR>
我查查BUG.&nbsp;<BR>
&nbsp;<BR>
如果你想在你的MUD中用这些程序的话，把你的&nbsp;<BR>
Email和MUD服务器地址端口告诉我吧。&nbsp;<BR>
&nbsp;<BR>
<A HREF="MailTo:"></A>&nbsp;hhx_<A HREF="mailto:imu@263.net">imu@263.net</A>&nbsp;<BR>
&nbsp;<BR>
----------------------------------------------------------------&nbsp;<BR>
什么?&nbsp;CGI程序怎么写？&nbsp;<BR>
给两个例子吧。&nbsp;<BR>
请看：南城客栈留言板。&nbsp;<BR>
&nbsp;<BR>
//&nbsp;SCGI:&nbsp;/adm/cgi/board.c&nbsp;<BR>
//&nbsp;created&nbsp;by&nbsp;wind&nbsp;98/12/10&nbsp;<BR>
//&nbsp;last&nbsp;change:&nbsp;98/12/16&nbsp;<BR>
&nbsp;<BR>
#pragma&nbsp;save_binary&nbsp;<BR>
&nbsp;<BR>
#include&nbsp;&lt;ansi.h&gt;&nbsp;<BR>
&nbsp;<BR>
#define&nbsp;FORM_METHOD&nbsp;&quot;post&quot;&nbsp;<BR>
#define&nbsp;BOARD&nbsp;&quot;/obj/board/nancheng_b&quot;&nbsp;<BR>
#define&nbsp;REPLY&nbsp;&quot;RE:&quot;&nbsp;<BR>
#define&nbsp;URL&nbsp;&quot;/scgi/board&quot;&nbsp;<BR>
&nbsp;<BR>
int&nbsp;min(int&nbsp;a,int&nbsp;b)&nbsp;<BR>
{&nbsp;<BR>
	return&nbsp;a&gt;b?b:a;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
int&nbsp;max(int&nbsp;a,int&nbsp;b)&nbsp;<BR>
{&nbsp;<BR>
	return&nbsp;a&lt;b?b:a;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
string&nbsp;parse_html(string&nbsp;msg)&nbsp;<BR>
{&nbsp;<BR>
msg&nbsp;=&nbsp;replace_string(msg,&nbsp;&quot;\r&quot;,&quot;&quot;);&nbsp;<BR>
msg&nbsp;=&nbsp;replace_string(msg,&nbsp;&quot;\n&quot;,&quot;&lt;br&gt;\n&quot;);&nbsp;<BR>
msg&nbsp;=&nbsp;replace_string(msg,&nbsp;&quot;&nbsp;&nbsp;&quot;,&quot;　&quot;);&nbsp;<BR>
msg&nbsp;=&nbsp;replace_string(msg,&nbsp;&quot;\t&quot;,&quot;　　　　&quot;);&nbsp;<BR>
return&nbsp;msg;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
string&nbsp;main(string&nbsp;arg)&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;object&nbsp;ob;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;string&nbsp;head=HTTP_D-&gt;ext_type(&quot;html&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;string&nbsp;str,str2;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;int&nbsp;num,i;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;mapping&nbsp;*&nbsp;notes;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;string&nbsp;con;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;object&nbsp;who;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;mapping&nbsp;args;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(!arg||!stringp(arg))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg=&quot;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;args=HTTP_D-&gt;form_parse(arg);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(!args||sizeof(args)==0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args=([&quot;list&quot;:0]);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg=&quot;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;str=head+HTTP_D-&gt;std_head(&quot;南城客栈留言板&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;ob=find_object(BOARD);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(!ob)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob=load_object(BOARD);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(!ob)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;该留言板不存在！&lt;br&gt;\n&quot;+HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;if&nbsp;(!undefinedp(args[&quot;list&quot;]))&nbsp;<BR>
&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(!stringp(args[&quot;list&quot;]))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num=0;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sscanf(args[&quot;list&quot;],&quot;%d&quot;,num);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;notes&nbsp;=&nbsp;ob-&gt;query(&quot;notes&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(&nbsp;!pointerp(notes)&nbsp;||&nbsp;!sizeof(notes)&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;留言板上目前没有任何留言。&lt;br&gt;\n&quot;+HTTP_D-&gt;str_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;num--;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num=sizeof(notes)-20;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(num&gt;=sizeof(notes))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num=sizeof(notes)-20;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;font&nbsp;size=5&gt;西游记之南城客栈留言板&lt;font&nbsp;size=4&gt;&lt;/center&gt;&quot;;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&gt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,max(num-20+1,1))+&quot;\&quot;&gt;上一页&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;sizeof(notes)-20)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,num+20+1)+&quot;\&quot;&gt;下一页&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇,到第&lt;input&nbsp;type=\&quot;text\&quot;&nbsp;name=\&quot;list\&quot;&nbsp;size=4&gt;篇&nbsp;<BR>
&quot;,sizeof(notes));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;table&nbsp;border=3&nbsp;WIDTH=\&quot;80%\&quot;&gt;&lt;tr&gt;&lt;th&nbsp;width=10%&gt;序号&nbsp;<BR>
&lt;/th&gt;&lt;th&gt;标题&lt;/th&gt;&lt;th&nbsp;width=25%&gt;代号&lt;/th&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=num;i&lt;min(num+20,sizeof(notes));i++)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;tr&gt;&lt;td&gt;&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;td&gt;&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;\&quot;&gt;&quot;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+HTTP_D-&gt;parse_color(notes[i][&quot;title&quot;])+&quot;&lt;/a&gt;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;str&gt;&lt;td&gt;&quot;+notes[i][&quot;author&quot;]+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/tr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/table&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&gt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,max(num-20+1,1))+&quot;\&quot;&gt;上一页&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;sizeof(notes)-20)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,num+20+1)+&quot;\&quot;&gt;下一页&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇,到第&lt;input&nbsp;type=\&quot;text\&quot;&nbsp;name=\&quot;list\&quot;&nbsp;size=4&gt;篇&nbsp;<BR>
&quot;,sizeof(notes));&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;}&nbsp;<BR>
&nbsp;else&nbsp;<BR>
&nbsp;if&nbsp;(!undefinedp(args[&quot;topic&quot;])&amp;&amp;stringp(args[&quot;topic&quot;]))&nbsp;<BR>
&nbsp;{&nbsp;<BR>
&nbsp;	int&nbsp;cc;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;notes&nbsp;=&nbsp;ob-&gt;query(&quot;notes&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(&nbsp;!pointerp(notes)&nbsp;||&nbsp;!sizeof(notes)&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notes=({&nbsp;});&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(strsrch(args[&quot;topic&quot;],REPLY)==0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args[&quot;topic&quot;]=args[&quot;topic&quot;][sizeof(REPLY)..];&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc=0;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;for(i=0;i&lt;sizeof(notes);i++)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	if&nbsp;(notes[i][&quot;title&quot;]==args[&quot;topic&quot;]||&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;notes[i][&quot;title&quot;]==REPLY+args[&quot;topic&quot;])&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;		cc++;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;font&nbsp;size=5&gt;主题为:“&quot;+HTTP_D-&gt;parse_color(args[&quot;topic&quot;])+&nbsp;<BR>
&quot;”的文章&lt;font&nbsp;size=4&gt;&lt;/center&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇&quot;,cc);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;table&nbsp;border=3&nbsp;WIDTH=\&quot;80%\&quot;&gt;&lt;tr&gt;&lt;th&nbsp;width=10%&gt;序号&nbsp;<BR>
&lt;/th&gt;&lt;th&gt;标题&lt;/th&gt;&lt;th&nbsp;width=25%&gt;代号&lt;/th&gt;\n&quot;;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;for(i=0;i&lt;sizeof(notes);i++)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	if&nbsp;(notes[i][&quot;title&quot;]==args[&quot;topic&quot;]||&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;notes[i][&quot;title&quot;]==REPLY+args[&quot;topic&quot;])&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;tr&gt;&lt;td&gt;&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;td&gt;&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;\&quot;&gt;&quot;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+HTTP_D-&gt;parse_color(notes[i][&quot;title&quot;])+&quot;&lt;/a&gt;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;str&gt;&lt;td&gt;&quot;+notes[i][&quot;author&quot;]+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/tr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/table&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇&quot;,cc);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;}&nbsp;<BR>
&nbsp;else&nbsp;<BR>
&nbsp;if&nbsp;(!undefinedp(args[&quot;writer&quot;])&amp;&amp;stringp(args[&quot;writer&quot;]))&nbsp;<BR>
&nbsp;{&nbsp;<BR>
&nbsp;	int&nbsp;cc;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;notes&nbsp;=&nbsp;ob-&gt;query(&quot;notes&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(&nbsp;!pointerp(notes)&nbsp;||&nbsp;!sizeof(notes)&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notes=({&nbsp;});&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc=0;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;for(i=0;i&lt;sizeof(notes);i++)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	if&nbsp;(notes[i][&quot;author&quot;]==args[&quot;writer&quot;])&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;		cc++;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;font&nbsp;size=5&gt;作者为:“&quot;+args[&quot;writer&quot;]+&quot;”的文章&lt;font&nbsp;&nbsp;<BR>
size=4&gt;&lt;/center&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇&quot;,cc);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;&lt;table&nbsp;border=3&nbsp;WIDTH=\&quot;80%\&quot;&gt;&lt;tr&gt;&lt;th&nbsp;width=10%&gt;序号&nbsp;<BR>
&lt;/th&gt;&lt;th&gt;标题&lt;/th&gt;&lt;th&nbsp;width=25%&gt;代号&lt;/th&gt;\n&quot;;&nbsp;<BR>
&nbsp;<BR>
&nbsp;&nbsp;&nbsp;for(i=0;i&lt;sizeof(notes);i++)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	if&nbsp;(notes[i][&quot;author&quot;]==args[&quot;writer&quot;])&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;tr&gt;&lt;td&gt;&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;td&gt;&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,i+1)+&quot;\&quot;&gt;&quot;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+HTTP_D-&gt;parse_color(notes[i][&quot;title&quot;])+&quot;&lt;/a&gt;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;str&gt;&lt;td&gt;&quot;+notes[i][&quot;author&quot;]+&quot;&lt;/td&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/tr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/table&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;form&nbsp;action=\&quot;&quot;URL&quot;\&quot;&nbsp;method=\&quot;&quot;FORM_METHOD&quot;\&quot;&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=sprintf(&quot;&nbsp;共%d篇&quot;,cc);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=\&quot;&gt;发表文章&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/form&gt;&lt;/center&gt;\n&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;}&nbsp;<BR>
&nbsp;else&nbsp;<BR>
if&nbsp;(!undefinedp(args[&quot;read&quot;]))&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;if&nbsp;(!stringp(args[&quot;read&quot;]))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;num=0;&nbsp;<BR>
&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;sscanf(args[&quot;read&quot;],&quot;%d&quot;,num);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;notes&nbsp;=&nbsp;ob-&gt;query(&quot;notes&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(&nbsp;!pointerp(notes)&nbsp;||&nbsp;!sizeof(notes)&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;留言板上目前没有任何留言。&lt;br&gt;\n&quot;+HTTP_D-&gt;str_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;num--;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num=sizeof(notes)-1;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if(&nbsp;num&nbsp;&lt;&nbsp;0&nbsp;||&nbsp;num&nbsp;&gt;=&nbsp;sizeof(notes)&nbsp;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;没有这张留言。\n&quot;+HTTP_D-&gt;str_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;str=head+HTTP_D-&gt;std_head(&quot;南城客栈留言板,第&quot;+sprintf(&quot;%d&quot;,num+1)+&quot;篇文章&nbsp;<BR>
&quot;);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&gt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,num-1+1)+&quot;\&quot;&gt;上一篇&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;sizeof(notes)-1)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,num+1+1)+&quot;\&quot;&gt;下一篇&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,num+1)+&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?topic=&quot;+notes[num][&quot;title&quot;]+&quot;\&quot;&gt;同主题&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?writer=&quot;+notes[num][&quot;author&quot;]+&quot;\&quot;&gt;同作者&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=&quot;+notes[num][&quot;title&quot;]+&quot;\&quot;&gt;回信&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;/center&gt;&lt;hr&gt;&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;str2=sprintf(&nbsp;<BR>
&quot;[%d]&nbsp;%-40s&nbsp;%s(%s)\n----------------------------------------------------------&nbsp;<BR>
------------\n&quot;,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num+1&nbsp;,&nbsp;HTTP_D-&gt;parse_color(notes[num][&quot;title&quot;]),&nbsp;notes[num][&quot;author&quot;],&nbsp;&nbsp;<BR>
ctime(notes[num][&quot;time&quot;])[0..9])&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;HTTP_D-&gt;parse_color(notes[num][&quot;msg&quot;]);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=parse_html(str2);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&lt;hr&gt;&lt;center&gt;[&lt;a&nbsp;href=\&quot;/\&quot;&gt;回到西游记主页&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&gt;0)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,num-1+1)+&quot;\&quot;&gt;上一篇&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(num&lt;sizeof(notes)-1)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?read=&quot;+sprintf(&quot;%d&quot;,num+1+1)+&quot;\&quot;&gt;下一篇&nbsp;<BR>
&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?list=&quot;+sprintf(&quot;%d&quot;,num+1)+&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?topic=&quot;+notes[num][&quot;title&quot;]+&quot;\&quot;&gt;同主题&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?writer=&quot;+notes[num][&quot;author&quot;]+&quot;\&quot;&gt;同作者&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=&quot;&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;?post=&quot;+notes[num][&quot;title&quot;]+&quot;\&quot;&gt;回信&lt;/a&gt;]&quot;;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str+=HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;if&nbsp;(!undefinedp(args[&quot;post&quot;]))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;if&nbsp;(!stringp(args[&quot;post&quot;]))&nbsp;<BR>
&nbsp;&nbsp;&nbsp;con=&quot;&quot;;&nbsp;<BR>
&nbsp;&nbsp;else&nbsp;<BR>
&nbsp;&nbsp;&nbsp;con=args[&quot;post&quot;];&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	if&nbsp;(strsrch(con,REPLY)!=0&amp;&amp;con!=&quot;&quot;)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;con=REPLY+con;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;<BR>
str=head+HTTP_D-&gt;std_head(&quot;发表文章&quot;);&nbsp;<BR>
str+=&quot;&lt;center&gt;&nbsp;<BR>
[&lt;a&nbsp;href=\&quot;/\&quot;&gt;返回首页&lt;/a&gt;]&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&lt;/center&gt;&nbsp;<BR>
&lt;hr&gt;&nbsp;<BR>
&lt;form&nbsp;method=&quot;FORM_METHOD&quot;&nbsp;action=\&quot;&quot;URL&quot;\&quot;&gt;&lt;p&gt;&nbsp;<BR>
使用标题&nbsp;&lt;input&nbsp;type=text&nbsp;name=title&nbsp;size=40&nbsp;maxlength=100&nbsp;value=\&quot;&quot;+con+&quot;\&quot;&gt;&lt;&nbsp;<BR>
br&gt;&nbsp;<BR>
您的代号&nbsp;&lt;input&nbsp;type=text&nbsp;name=username&nbsp;size=15&nbsp;maxlength=20&gt;&lt;br&gt;&nbsp;<BR>
您的密码&nbsp;&lt;input&nbsp;type=password&nbsp;name=passwd&nbsp;size=15&nbsp;maxlength=20&gt;&lt;br&gt;&nbsp;<BR>
&lt;/p&gt;&lt;textarea&nbsp;name=text&nbsp;rows=20&nbsp;cols=60&gt;&nbsp;<BR>
&lt;/textarea&gt;&nbsp;<BR>
&lt;center&gt;&lt;p&gt;&lt;input&nbsp;type=submit&nbsp;value=\&quot;发表\&quot;&gt;&nbsp;&lt;input&nbsp;type=reset&nbsp;value=\&quot;清除&nbsp;<BR>
\&quot;&gt;&lt;/P&gt;&lt;/center&gt;&nbsp;<BR>
&lt;/form&gt;&nbsp;<BR>
&lt;hr&gt;&nbsp;<BR>
&lt;center&gt;&nbsp;<BR>
[&lt;a&nbsp;href=\&quot;/\&quot;&gt;返回首页&lt;/a&gt;]&nbsp;[&lt;a&nbsp;href=\&quot;&quot;URL&quot;\&quot;&gt;本讨论区&lt;/a&gt;]&lt;/center&gt;&nbsp;<BR>
&lt;/body&gt;&nbsp;<BR>
&lt;/html&gt;&quot;;&nbsp;<BR>
return&nbsp;str;&nbsp;<BR>
}&nbsp;<BR>
else&nbsp;<BR>
&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;	if&nbsp;(stringp(args[&quot;title&quot;])&amp;&amp;stringp(args[&quot;username&quot;])&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&amp;&amp;stringp(args[&quot;passwd&quot;])&amp;&amp;stringp(args[&quot;text&quot;])&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&amp;&amp;args[&quot;title&quot;]!=&quot;&quot;&amp;&amp;args[&quot;username&quot;]!=&quot;&quot;&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&amp;&amp;args[&quot;passwd&quot;]!=&quot;&quot;&amp;&amp;args[&quot;text&quot;]!=&quot;&quot;)&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;	args[&quot;text&quot;]+=&quot;\n\n&quot;HIG&quot;[WWW-POST]&quot;NOR&quot;\n&quot;;&nbsp;<BR>
	&nbsp;&nbsp;&nbsp;	&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seteuid(ROOT_UID);&nbsp;<BR>
&nbsp;&nbsp;	who=new(LOGIN_OB);&nbsp;<BR>
who-&gt;set(&quot;id&quot;,args[&quot;username&quot;]);&nbsp;<BR>
if&nbsp;(!who-&gt;restore()||crypt(args[&quot;passwd&quot;],&nbsp;who-&gt;query(&quot;password&quot;))&nbsp;&nbsp;<BR>
!=who-&gt;query(&quot;password&quot;))&nbsp;<BR>
{&nbsp;<BR>
str=head+HTTP_D-&gt;std_head(&quot;密码错误&quot;)+&nbsp;<BR>
&quot;&lt;P&gt;密码错误...&nbsp;&lt;/P&gt;&quot;&nbsp;<BR>
+HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;destruct(who);&nbsp;<BR>
}&nbsp;<BR>
else&nbsp;<BR>
{&nbsp;<BR>
&nbsp;&nbsp;&nbsp;mapping&nbsp;note=([&nbsp;]);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;note+=([&nbsp;&quot;title&quot;:args[&quot;title&quot;]&nbsp;]);&nbsp;<BR>
&nbsp;&nbsp;&nbsp;note+=([&nbsp;&quot;author&quot;:&nbsp;who-&gt;query(&quot;name&quot;)+&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;(&quot;+capitalize(who-&gt;query(&quot;id&quot;))+&quot;)&quot;]);&nbsp;<BR>
&nbsp;&nbsp;BOARD-&gt;done_post(who,&nbsp;note,&nbsp;args[&quot;text&quot;]);&nbsp;<BR>
&nbsp;&nbsp;destruct(who);&nbsp;<BR>
str=head+HTTP_D-&gt;std_refresh_head(&quot;正在传送&quot;,5,&quot;&quot;URL&quot;&quot;)+&nbsp;<BR>
&quot;&lt;P&gt;您的文章现在正被送往MUD系统中，请等待片刻...&nbsp;&lt;/P&gt;&nbsp;<BR>
&lt;P&gt;如果过会儿您没有在南城客栈留言板上看到您的新文章，请检查您输入的讨论区名称&nbsp;<BR>
、用户名和口令是否正确。&nbsp;过一会儿再试试看。&lt;/P&gt;&quot;&nbsp;<BR>
+HTTP_D-&gt;std_end();&nbsp;<BR>
}&nbsp;<BR>
seteuid(getuid());&nbsp;<BR>
&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
}&nbsp;<BR>
else&nbsp;<BR>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;{&nbsp;<BR>
str=head+HTTP_D-&gt;std_head(&quot;错误&quot;)+&nbsp;<BR>
&quot;&lt;P&gt;您发出的命令有错误。&lt;/P&gt;&nbsp;<BR>
&lt;P&gt;可能是某些项目没有正确填写。&lt;/P&gt;&quot;&nbsp;<BR>
+HTTP_D-&gt;std_end();&nbsp;<BR>
&nbsp;&nbsp;&nbsp;return&nbsp;str;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;&nbsp;}&nbsp;<BR>
&nbsp;&nbsp;&nbsp;return&nbsp;head+&quot;&nbsp;&quot;;&nbsp;<BR>
}&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
&nbsp;<BR>
--&nbsp;<BR>
※&nbsp;来源:・BBS&nbsp;水木清华站&nbsp;bbs.net.tsinghua.edu.cn・[FROM:&nbsp;202.207.8.112]&nbsp;&nbsp;<BR>
<A HREF="00000003.htm">上一篇</A>
<A HREF='javascript:history.go(-1)'>返回上一页</A>
<A HREF="index.htm">回到目录</A>
<A HREF="#top">回到页首</A>
<A HREF="00000005.htm">下一篇</A>
</H1></CENTER>
<CENTER><H1>BBS水木清华站∶精华区</H1></CENTER>
</BODY></HTML>